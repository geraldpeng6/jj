# 量化交易系统 - 日期处理修复

本项目是一个量化交易系统，提供K线数据获取、回测和图表生成功能。

## 问题描述

系统存在日期处理相关的问题，主要表现为：

1. K线图表和回测数据未显示最近日期 - 数据应该覆盖从2024-05-28到2025-05-28，但只显示到2025-05-22
2. 非闰年2月29日等无效日期无法被正确处理
3. 系统未正确使用北京时间（UTC+8）
4. 未来日期被错误地截断，导致无法使用

## 修复方案

我们对系统进行了以下修复：

1. 创建了新的`date_utils.py`工具模块，提供北京时间转换和日期验证功能
2. 修改了`symbol_utils.py`中的日期验证逻辑，避免不必要地截断有效的未来日期
3. 更新了`kline_utils.py`中的日期处理，增强了日志记录和错误处理
4. 改进了`chart_generator.py`中的日期显示，提供更准确的信息
5. 更新了`backtest_utils.py`，使其正确处理日期范围和无效日期

## 测试和部署

### 部署

运行以下命令以部署系统：

```bash
chmod +x deploy.sh
./deploy.sh
```

部署脚本会：
- 创建必要的目录结构
- 设置Python虚拟环境
- 安装所有依赖项

### 测试日期处理

我们提供了三个测试脚本来验证日期处理：

1. **K线数据测试**:
   ```bash
   python test_kline.py
   ```
   测试K线数据获取功能，特别是日期处理和验证。

2. **股票日期验证测试**:
   ```bash
   python debug_symbol_utils.py
   ```
   测试`symbol_utils.py`中的日期验证逻辑，重点检查未来日期处理。

3. **回测日期测试**:
   ```bash
   python fix_backtest_dates.py
   ```
   测试回测功能中的日期处理，确保正确处理未来日期范围。

### 日志文件

所有测试脚本都会在`logs/`目录下生成详细的日志文件：
- `logs/test_kline.log`
- `logs/debug_symbol_utils.log`
- `logs/fix_backtest_dates.log`

请检查这些日志文件以获取详细的测试结果和诊断信息。

## 修复验证

运行测试脚本后，应验证以下几点：

1. 系统能够正确处理从2024-05-28到2025-05-28的日期范围
2. 无效日期（如2025-02-29）被正确处理和报告
3. 系统使用北京时间（UTC+8）
4. 未来日期不再被错误截断

## 主要修改文件

1. 新增: `utils/date_utils.py` - 日期工具模块
2. 修改: `utils/symbol_utils.py` - 修复日期验证逻辑
3. 修改: `utils/kline_utils.py` - 改进K线数据获取中的日期处理
4. 修改: `utils/backtest_utils.py` - 更新回测功能中的日期处理
5. 修改: `utils/chart_generator.py` - 改进图表中的日期显示

## 注意事项

- 运行测试前，请确保已正确配置认证信息
- 测试脚本会向API发送真实请求，请注意调用频率限制
- 某些测试用例可能需要根据实际环境进行调整 